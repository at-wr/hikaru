---
import BaseLayout from './BaseLayout.astro';
import type { CollectionEntry } from 'astro:content';
import Header from '../components/Header.astro';
import FooterLicense from '../components/ui/FooterLicense.astro';

interface Props {
  post: CollectionEntry<'posts'>;
}

const { post } = Astro.props;
const { title, published, category, tags, description, language = 'en' } = post.data;

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": title,
  "description": description || title,
  "datePublished": published.toISOString(),
  "inLanguage": language?.replace("_", "-") || "en",
  "author": {
    "@type": "Person",
    "name": "Alan Ye",
    "url": Astro.site?.href || "https://wrye.dev"
  },
  "publisher": {
    "@type": "Person",
    "name": "Alan Ye",
    "url": Astro.site?.href || "https://wrye.dev"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": Astro.url.href
  },
  "articleSection": category,
  "keywords": tags.join(", "),
  "image": `${Astro.site?.href || "https://wrye.dev/"}og/posts/${post.slug}.png`
};

const publishedDate = new Date(published).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<BaseLayout title={title} description={description} language={language}>
  <Fragment slot="header">
    <Header customTitle="Alan's Blog" />
  </Fragment>
  
  
  <Fragment slot="head">
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content={published.toISOString()} />
    {tags.length > 0 && (
      <meta property="article:tag" content={tags.join(', ')} />
    )}
    {category && (
      <meta property="article:section" content={category} />
    )}
    {language && (
      <meta property="og:locale" content={language.replace('-', '_')} />
    )}
    <meta name="twitter:card" content="summary_large_image" />
  </Fragment>
  
  <script is:inline slot="head" type="application/ld+json" set:html={JSON.stringify(jsonLd)}></script>
  <div class="min-h-screen bg-white dark:bg-slate-900">
    
    <article class="px-8 md:px-16 lg:px-24 py-16" style="view-transition-name: blog-content;">
      <div class="max-w-4xl mx-auto">
        
        <header class="mb-12">
          <div class="mb-6">
            <a 
              href={`/archive/category/${category.toLowerCase().replace(/\s+/g, '-')}`}
              class="inline-block px-3 py-1 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-full text-sm font-medium mb-4 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors focus-ring"
            >
              {category}
            </a>
            <h1 class="text-4xl md:text-5xl font-light text-slate-900 dark:text-slate-100 mb-4 leading-tight">
              {title}
            </h1>
            <p class="text-lg text-slate-600 dark:text-slate-300 leading-relaxed mb-6">
              {description}
            </p>
          </div>
          
          
          <div class="flex flex-wrap items-center gap-4 text-sm text-slate-500 dark:text-slate-400 font-mono">
            <time datetime={published.toISOString()}>
              {publishedDate}
            </time>
            <div class="flex flex-wrap gap-2">
              {tags.map(tag => (
                <a 
                  href={`/archive/tag/${tag.toLowerCase().replace(/\s+/g, '-')}`}
                  class="skill-tag hover:bg-slate-200 focus-ring"
                >
                  {tag}
                </a>
              ))}
            </div>
          </div>
        </header>

        
        <div class="prose prose-lg max-w-none min-w-0">
          <div class="blog-content">
            <slot />
          </div>
        </div>

        
        <footer class="mt-16 pt-8 border-t border-slate-200 dark:border-slate-700 space-y-6">
          
          <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
            <a 
              href="/archive" 
              class="inline-flex items-center text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 transition-colors text-sm font-mono"
            >
              ← Back to Archive
            </a>
            <div class="text-sm text-slate-500 dark:text-slate-400 font-mono text-center sm:text-right">
              <span class="whitespace-nowrap">© {new Date().getFullYear()} Alan Ye.</span>
              <FooterLicense class="ml-2" />
            </div>
          </div>
        </footer>
      </div>
    </article>
  </div>
</BaseLayout>

<style>
  @reference "tailwindcss";
  
  .blog-content {
    @apply text-slate-700 dark:text-slate-300 leading-relaxed;
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
  }

  .blog-content :global(h1) {
    @apply text-3xl font-light text-slate-900 dark:text-slate-100 mb-6 mt-12 first:mt-0;
    font-variation-settings: 'wght' 300;
  }

  .blog-content :global(h2) {
    @apply text-2xl font-light text-slate-900 dark:text-slate-100 mb-4 mt-10;
    font-variation-settings: 'wght' 300;
  }

  .blog-content :global(h3) {
    @apply text-xl font-medium text-slate-800 dark:text-slate-200 mb-3 mt-8;
    font-variation-settings: 'wght' 500;
  }

  .blog-content :global(h4) {
    @apply text-lg font-medium text-slate-800 dark:text-slate-200 mb-2 mt-6;
    font-variation-settings: 'wght' 500;
  }

  .blog-content :global(p) {
    @apply mb-6 text-base leading-relaxed;
    word-break: break-word;
    overflow-wrap: break-word;
  }

  .blog-content :global(ul), 
  .blog-content :global(ol) {
    @apply mb-6 pl-6 space-y-2;
  }

  .blog-content :global(li) {
    @apply text-base leading-relaxed;
    word-break: break-word;
    overflow-wrap: break-word;
  }

  .blog-content :global(ul li) {
    @apply list-disc;
  }

  .blog-content :global(ol li) {
    @apply list-decimal;
  }

  .blog-content :global(blockquote) {
    @apply border-l-4 border-slate-300 dark:border-slate-700 pl-6 py-2 my-6 italic text-slate-600 dark:text-slate-400;
    word-break: break-word;
    overflow-wrap: break-word;
  }

  .blog-content :global(:not(pre) > code) {
    @apply bg-slate-100 text-slate-800 dark:bg-slate-800 dark:text-slate-100 px-2 py-1 rounded text-sm font-mono;
    word-break: break-word;
    overflow-wrap: break-word;
  }

  .blog-content :global(pre) {
    @apply p-6 rounded-lg overflow-x-auto mb-6 text-sm;
    overflow-x: auto;
    white-space: pre-wrap;
    word-break: break-word;
  }

  .blog-content :global(pre code) {
    @apply p-0;
    background: transparent;
  }

  .blog-content :global(pre:not([class*="astro-code"])) {
    @apply bg-slate-50 text-slate-800 dark:bg-slate-900 dark:text-slate-100;
  }

  .blog-content :global(a) {
    @apply text-slate-900 dark:text-slate-100 underline hover:text-slate-600 dark:hover:text-slate-300 transition-colors;
    word-break: break-word;
    overflow-wrap: break-word;
  }

  .blog-content :global(img) {
    @apply rounded-lg shadow-sm mb-6 max-w-full h-auto;
  }

  .blog-content :global(table) {
    @apply w-full border-collapse border border-slate-300 dark:border-slate-700 mb-6;
    word-break: break-word;
    overflow-wrap: break-word;
  }

  .blog-content :global(th), 
  .blog-content :global(td) {
    @apply border border-slate-300 dark:border-slate-700 px-4 py-2 text-left;
  }

  .blog-content :global(th) {
    @apply bg-slate-50 dark:bg-slate-800 font-medium;
  }

  .blog-content :global(hr) {
    @apply border-t border-slate-200 dark:border-slate-700 my-12;
  }

  .skill-tag {
    @apply px-2 py-1 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded text-xs font-mono;
    @apply hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors duration-200;
  }
</style>
