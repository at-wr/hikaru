---
import HeroSection from "./ui/HeroSection.astro";
import ContentSection from "./ui/ContentSection.astro";
import ProjectCard from "./ui/ProjectCard.astro";
import ExperienceItem from "./ui/ExperienceItem.astro";
import SkillsGroup from "./ui/SkillsGroup.astro";
import ExternalLink from "./ui/ExternalLink.astro";
import PostListItem from "./PostListItem.astro";

// Import data from centralized content file
import {
    skills,
    experiences,
    projects,
    contactMethods,
    heroContent,
    aboutContent,
    contactContent,
} from "../data/content";

// Import blog posts
import { getCollection } from "astro:content";

// Get recent blog posts (latest 3)
const recentPosts = await getCollection("posts", ({ data }) => {
    return !data.draft;
}).then((posts) =>
    posts
        .sort(
            (a, b) =>
                new Date(b.data.published).getTime() -
                new Date(a.data.published).getTime(),
        )
        .slice(0, 3),
);
---

<div class="min-h-screen bg-white">
    <!-- Hero Section -->
    <HeroSection subtitle={heroContent.subtitle} />

    <!-- Main Content -->
    <main
        id="main-content"
        class="px-8 md:px-16 lg:px-24 pb-24 content-container"
        style="view-transition-name: main-content;"
    >
        <div class="max-w-4xl mx-auto space-y-16 md:space-y-24">
            <!-- About Section -->
            <ContentSection title="About" id="about">
                <div class="space-y-4">
                    {
                        aboutContent.paragraphs.map((paragraph) => (
                            <p class="body-text text-base md:text-lg text-slate-600 leading-relaxed">
                                {paragraph}
                            </p>
                        ))
                    }
                </div>
            </ContentSection>

            <!-- Blog Section -->
            <div
                class="content-section border-l-2 border-slate-200 pl-6 md:pl-8"
                id="blog"
            >
                <h2
                    class="section-heading text-2xl md:text-3xl lg:text-4xl text-slate-900 mb-4 md:mb-6 tracking-wide"
                >
                    <a
                        href="/archive"
                        class="hover:text-slate-600 transition-colors no-underline inline-block"
                    >
                        Recent Posts
                    </a>
                </h2>
                <div class="space-y-6">
                    {
                        recentPosts.map((post) => (
                            <PostListItem
                                title={post.data.title}
                                description={post.data.description}
                                slug={post.slug}
                                published={post.data.published}
                                size="small"
                            />
                        ))
                    }

                    <!-- {/* View all posts link */}
            <div class="pt-4">
              <a
                href="/archive"
                class="inline-flex items-center text-slate-900 hover:text-slate-600 transition-colors text-sm"
              >
                View all posts â†’
              </a>
            </div> -->
                </div>
            </div>

            <!-- Skills Section -->
            <ContentSection title="Skills" id="skills">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {
                        skills.map((skillGroup) => (
                            <SkillsGroup
                                title={skillGroup.title}
                                skills={skillGroup.skills}
                            />
                        ))
                    }
                </div>
            </ContentSection>

            <!-- Experience Section -->
            <ContentSection title="Experience" id="experience">
                <div class="space-y-8">
                    {experiences.map((exp) => <ExperienceItem {...exp} />)}
                </div>
            </ContentSection>

            <!-- Projects Section -->
            <ContentSection title="Projects" id="projects">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {projects.map((project) => <ProjectCard {...project} />)}
                </div>
            </ContentSection>

            <!-- Contact Section -->
            <ContentSection title="Contact" id="contact">
                <div class="space-y-4">
                    <p
                        class="body-text text-base md:text-lg text-slate-600 leading-relaxed"
                    >
                        {contactContent.description}
                    </p>
                    <div class="flex flex-col sm:flex-row gap-4 flex-wrap">
                        {
                            contactMethods.map((contact) => (
                                <ExternalLink
                                    href={contact.href}
                                    external={contact.external}
                                    id={
                                        contact.label === "Email"
                                            ? "email-link"
                                            : undefined
                                    }
                                    rel={contact.rel || undefined}
                                >
                                    {contact.label}
                                </ExternalLink>
                            ))
                        }
                    </div>
                </div>
            </ContentSection>

            <!-- Extras Links Section -->
            <ContentSection title="Extras" id="extras">
                <div class="space-y-4">
                    <p
                        class="body-text text-base md:text-lg text-slate-600 leading-relaxed"
                    >
                        Discover more through these curated connections across
                        the web.
                    </p>
                    <div class="flex flex-col sm:flex-row gap-4 flex-wrap">
                        <ExternalLink href="/friends" external={false}>
                            Friends
                        </ExternalLink>
                        <ExternalLink
                            href="https://www.travellings.cn/plain.html"
                        >
                            Travellings
                        </ExternalLink>
                    </div>
                </div>
            </ContentSection>

            <!-- Footer -->
            <div class="border-t border-slate-200 pt-8 mt-16">
                <div
                    class="flex flex-col sm:flex-row justify-between items-center text-sm text-slate-500 font-mono"
                >
                    <div class="whitespace-nowrap">
                        Designed by Alan. All rights reserved.
                    </div>
                    <div class="mt-2 sm:mt-0 whitespace-nowrap">
                        Text licensed under
                        <a
                            href="https://creativecommons.org/licenses/by-sa/4.0/"
                            target="_blank"
                        class="text-slate-700 underline hover:text-slate-900 transition-colors"
                        >
                            CC BY-SA 4.0
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<script type="module">
    import initSectionHeadings from "../scripts/sectionHeading";
    import setupEmailProtection from "../scripts/emailProtection";

    initSectionHeadings();
    setupEmailProtection();
</script>

<style>
    @reference "tailwindcss";

    .content-section {
        @apply border-l-2 border-slate-200 pl-6 md:pl-8;
    }

    .section-heading {
        @apply text-2xl md:text-3xl lg:text-4xl text-slate-900 mb-4 md:mb-6 tracking-wide;
        font-variation-settings:
            "wght" 300,
            "wdth" 100;
        transition: font-variation-settings 0.1s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Make focus underline thinner on post titles/descriptions in homepage Recent Posts (override global) */
    #blog :global(.post-item a:focus-visible) {
        text-decoration-thickness: 1.5px !important;
        text-underline-offset: 3px !important;
    }
</style>
